create table users (
	user_id 	INTEGER GENERATED BY DEFAULT AS identity primary key,
	nick 		TEXT not null,
	password 	TEXT not null
);

CREATE TABLE people(
	person_id	INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	name		TEXT NOT NULL,
	surname		TEXT NOT NULL
);

CREATE TABLE positions(
	position_id			INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	position_name		TEXT NOT NULL
);

CREATE TABLE movies (
	movie_id			INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	title 				TEXT NOT NULL,
	year_of_production	INTEGER not null, 
	time				INTEGER not null,
	description			TEXT
);

CREATE TABLE people_movies(
	person_id		INTEGER REFERENCES people(person_id) on delete cascade,
	movie_id		INTEGER REFERENCES movies(movie_id) on delete cascade,
	position_id		INTEGER REFERENCES positions(position_id) on delete set null
);

CREATE TABLE genres(
	movie_id	INTEGER references movies(movie_id) on delete cascade,
	genre		TEXT not null
); 

create table countries (
	movie_id	INTEGER references movies(movie_id) on delete cascade,
	country		TEXT not null
);

CREATE TABLE reviews(
	review_id		INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	user_id			INTEGER REFERENCES users(user_id) on delete cascade, 
	movie_id 		INTEGER REFERENCES movies(movie_id) on delete cascade,
	rate			INTEGER CHECK (rate >= 0 AND rate <= 10),
	date			DATE NOT NULL,
	review			TEXT
);

create table all_lists(
	list_id 		INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	user_id			INTEGER references users(user_id) on delete cascade,
	list_name		TEXT
);

create table list(
	list_id			INTEGER references all_lists(list_id) on delete cascade,
	movie_id		INTEGER references movies(movie_id) on delete cascade,
	status			BOOL
);


create view movie_cast as
	select p.name, p.surname
	from people p natural join people_movies pm natural join movies m
	where 

	#obsada -> funkcja(film)
	#filmy z danego kraju -> f(kraj)
	#

